# Project.md

## Цель проекта

Создать масштабируемый API-сервис для скоринга и анализа данных, интегрируемый с внешними источниками (например, Яндекс.Метрика), с поддержкой ML-моделей и возможностью хранения/выгрузки результатов в облако (Supabase).

## Общая архитектура

- **API слой**: FastAPI (или аналогичный фреймворк, уточнить при необходимости)
- **Модули обработки**: Python-скрипты для загрузки, обработки и отправки данных (`app/`)
- **ML-инференс**: Использование joblib-моделей (`ml/`)
- **База данных**: Supabase/PostgreSQL, миграции через SQL-скрипты (`supabase/`)
- **Тестирование**: Pytest (`tests/`)
- **CI/CD**: (уточнить, если внедрено)

## Основные этапы разработки

1. Проектирование архитектуры и API
2. Реализация ETL-скриптов для сбора и обработки данных
3. Интеграция ML-моделей для скоринга
4. Настройка хранения и миграций БД
5. Разработка тестов и автоматизация
6. Документирование и поддержка

## Используемые технологии

- Python 3.10+
- FastAPI (или Flask, уточнить)
- Pydantic
- Supabase/PostgreSQL
- joblib (ML)
- Pytest
- Shell-скрипты (автоматизация)

## Критерии производительности

- Высокая скорость обработки запросов (до 1000 RPS, уточнить нагрузку)
- Асинхронная обработка данных
- Минимизация времени отклика ML-инференса (< 100 мс на запрос)

## Критерии безопасности

- Валидация входных данных через Pydantic
- Ограничение доступа к API (токены, OAuth, уточнить)
- Логирование и аудит операций

## Критерии поддерживаемости

- Модульная структура кода
- Покрытие тестами ключевых функций
- Документирование всех публичных интерфейсов
- Использование миграций для БД

## Прозрачность и согласованность

- Все изменения архитектуры и требований фиксируются в этом файле
- Вся команда обязана поддерживать актуальность документации

## Новый функционал: Вебхук для офлайн-конверсий

### Описание
Добавлен модуль вебхука, принимающий POST-запросы с данными о конверсиях (стоимость, параметры), выполняющий валидацию, сохранение и отправку в API Яндекс.Метрики (офлайн-конверсии).

### Архитектурные изменения
- **Вебхук-эндпоинт**: отдельный маршрут для приёма POST-запросов с конверсиями
- **Валидация**: строгая проверка структуры и типов данных (Pydantic)
- **Сохранение**: запись данных в БД (Supabase)
- **Интеграция с Яндекс.Метрикой**: отправка валидированных данных через API офлайн-конверсий

### Этапы
- Проектирование схемы данных для конверсий
- Реализация эндпоинта вебхука
- Интеграция с API Яндекс.Метрики
- Тестирование сценариев (валидные/невалидные данные, ошибки отправки)

### Технологии
- FastAPI: реализация вебхука
- Pydantic: валидация
- Supabase: хранение
- requests/httpx: интеграция с внешним API

### Критерии
- Безопасность: защита эндпоинта (токены, IP-фильтрация)
- Производительность: обработка до 100 RPS
- Надёжность: повторная отправка при ошибках, логирование 